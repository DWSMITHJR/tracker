<div class="nav-menu">
    <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">
        <i class="fas fa-home"></i> Home
    </NavLink>
    <NavLink class="nav-link" href="/incidents">
        <i class="fas fa-tasks"></i> Incidents
    </NavLink>
    <NavLink class="nav-link" href="/individuals">
        <i class="fas fa-users"></i> Individuals
    </NavLink>
    <NavLink class="nav-link" href="/contacts">
        <i class="fas fa-address-book"></i> Contacts
    </NavLink>
    <NavLink class="nav-link" href="/reports">
        <i class="fas fa-chart-line"></i> Reports
    </NavLink>
    @if (isAdmin || isOperator)
    {
        <NavLink class="nav-link" href="/logviewer">
            <i class="fas fa-file-alt"></i> Logs
        </NavLink>
    }
    @if (isAdmin)
    {
        <NavLink class="nav-link" href="/admin">
            <i class="fas fa-cog"></i> Admin
        </NavLink>
    }
</div>

@using Microsoft.AspNetCore.Components.Authorization

@code {
    private bool collapseNavMenu = true;
    private bool isAdmin = false;
    private bool isOperator = false;
    
    [Inject] private AuthenticationStateProvider AuthStateProvider { get; set; } = null!;

    private string NavMenuCssClass => collapseNavMenu ? "collapse" : string.Empty;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var authState = await AuthStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;
            
            if (user.Identity?.IsAuthenticated == true)
            {
                isAdmin = user.IsInRole("Admin");
                isOperator = user.IsInRole("Operator") || isAdmin; // Admins can also see operator menus
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error checking user roles: {ex.Message}");
        }
    }
}
